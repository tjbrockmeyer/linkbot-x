---
name: test-and-build
kind: pipeline
type: docker
trigger:
  ref:
    - refs/heads/master
    - refs/tags/v*.*.*
  event:
    - push
    - tag
steps:
  - name: test
    image: node:18.15.0
    commands:
      - npm ci
      - npm run test:ci
  - name: build
    image: plugins/docker
    settings:
      repo: cr.teabee.dev/linkbot
      tags: ${DRONE_BRANCH:+latest}${DRONE_TAG}
      dockerfile: docker/Dockerfile
      cache_from: cr.teabee.dev/linkbot:latest
